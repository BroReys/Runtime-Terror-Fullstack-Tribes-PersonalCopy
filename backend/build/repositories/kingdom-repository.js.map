{"version":3,"sources":["../../src/repositories/kingdom-repository.js"],"names":["createKingdom","kingdom","Kingdom","create","save","findKingdomById","id","findByPk","findKingdomByUserId","userId","findOne","where","findKingdomsByUserId","findAll","getAllKingdoms","getKingdomsTroops","kingdomId","Troops","attributes","exclude","getKingdomsBuildings","Building","getWinnerStats","group","sequelize","fn","col","order","literal","limit","count","getFirstPlayer","include","User","destroyBandits","destroy"],"mappings":"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","sourcesContent":["import Kingdom from \"../models/kingdom\";\nimport Troops from \"../models/troops-models/troops\";\nimport Building from \"../models/building\";\nimport sequelize from \"../config/database\";\nimport User from \"../models/user\";\nimport {re} from \"@babel/core/lib/vendor/import-meta-resolve\";\nimport kingdom from \"../models/kingdom\";\n\nconst createKingdom = async (kingdom) => Kingdom.create(kingdom);\n\nconst save = async (kingdom) => kingdom.save();\n\nconst findKingdomById = async (id) => Kingdom.findByPk(id);\n\nconst findKingdomByUserId = async (userId) => Kingdom.findOne(\n    {where: {userId}});\n\nconst findKingdomsByUserId = async (userId) => Kingdom.findAll(\n    {where: {userId}});\n\nconst getAllKingdoms = async () => Kingdom.findAll();\n\nconst getKingdomsTroops = async (kingdomId) => Troops.findAll({\n    where: {kingdomId},\n    attributes: {exclude: ['kingdomId','unitLevelId','destroyTime']}}\n);\n\nconst getKingdomsBuildings = async (kingdomId) => Building.findAll({\n    where: {kingdomId},\n    attributes: {exclude: ['kingdomId']}}\n);\n\nconst getWinnerStats = async () => await Kingdom.findAll({\n      group: 'userId',\n      attributes:\n          [\n            [sequelize.fn('COUNT', sequelize.col('userId')), 'count'],\n            'userId'\n          ],\n      order: sequelize.literal('count DESC'),\n      limit: 1\n    }\n);\n\nconst count = async () => Kingdom.count();\n\nconst getFirstPlayer = async () => await Kingdom.findOne({\n  include: User,\n  order: sequelize.literal('registeredAt ASC')\n});\n\nconst destroyBandits = async () => Kingdom.destroy({\n    where: {\n        userId: null\n    }\n});\n\nexport default {\n  save,\n  createKingdom,\n  findKingdomByUserId,\n  getAllKingdoms,\n  getKingdomsBuildings,\n  getKingdomsTroops,\n  findKingdomById,\n  getWinnerStats,\n  count,\n  getFirstPlayer,\n  findKingdomsByUserId,\n  destroyBandits\n};\n"],"file":"kingdom-repository.js"}