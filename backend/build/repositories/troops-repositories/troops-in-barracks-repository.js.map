{"version":3,"sources":["../../../src/repositories/troops-repositories/troops-in-barracks-repository.js"],"names":["createTroop","troop","Troops_in_barracks","create","newTroop","findKingdomTroopsInBarracks","kingdomId","findAll","where","findAllByKingdomIdAndUntil","currentTick","endTime","Op","lte","findKingdomTroopsInBarracksByTypeAndOrderByEndtimeDesc","type","sequelize","query","findTrainedKingdomTroopsInBarracksByType","Date","now","deleteAllAlreadyTrainedTroops","bulkCreateTroops","troops","bulkCreate"],"mappings":"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","sourcesContent":["import Troops from \"../../models/troops-models/troops\";\nimport kingdom from \"../../models/kingdom\";\nimport sequelize from \"../../config/database\";\nimport Troops_in_barracks from \"../../models/troops-models/troops-in-barracks\";\nimport {Op} from \"sequelize\";\n\nconst createTroop = async (troop) => {\n  const newTroop = await Troops_in_barracks.create(troop);\n  return newTroop;\n}\n\nconst findKingdomTroopsInBarracks = async (kingdomId) => {\n  return Troops_in_barracks.findAll({where: {kingdomId}});\n}\n\nconst findAllByKingdomIdAndUntil = async (kingdomId, currentTick) => {\n  return Troops_in_barracks.findAll({\n    where: {\n      kingdomId: kingdomId,\n      endTime: {[Op.lte]: currentTick}\n    }\n  });\n}\n\nconst findKingdomTroopsInBarracksByTypeAndOrderByEndtimeDesc = async (kingdomId, type) => {\n  return await sequelize\n  .query(`SELECT * FROM troops_in_barracks WHERE type = '${type}' AND kingdomId = ${kingdomId} ORDER BY endTime DESC`);\n}\n\nconst findTrainedKingdomTroopsInBarracksByType = async (kingdomId, type, currentTick) => {\n  if(!currentTick){\n    currentTick = Date.now()/1000;\n  }\n  return await sequelize\n  .query(`SELECT * FROM troops_in_barracks WHERE type = '${type}' AND kingdomId = ${kingdomId} AND endTime <= ${currentTick};`);\n}\n\nconst deleteAllAlreadyTrainedTroops = async () => {\n  await sequelize\n  .query(`DELETE FROM troops_in_barracks WHERE endTime <= ${Date.now()/1000};`)\n}\n\nconst bulkCreateTroops = async (troops) => {\n  await Troops_in_barracks.bulkCreate(troops);\n}\n\nexport default {\n  createTroop,\n  findKingdomTroopsInBarracks,\n  findKingdomTroopsInBarracksByTypeAndOrderByEndtimeDesc,\n  findTrainedKingdomTroopsInBarracksByType,\n  deleteAllAlreadyTrainedTroops,\n  bulkCreateTroops,\n  findAllByKingdomIdAndUntil\n}\n"],"file":"troops-in-barracks-repository.js"}