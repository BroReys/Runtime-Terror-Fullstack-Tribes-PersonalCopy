{"version":3,"sources":["../../../src/repositories/troops-repositories/troops-repository.js"],"names":["createTroop","troop","Troops","create","newTroop","findRecruitedTroopTypeByKingdomId","kingdomId","type","findOne","where","troopType","findRecruitedKingdomTroops","findAll","attributes","exclude","findAllKingdomTroops","findRandomKingdomTroop","Op","and","quantity","gt","order","sequelize","random","findRandomKingdomTroopInBattle","quantityInBattle","findTroopInBattle","AttackerTroopsToBattle","include","model","Battle","as","literal","findArrivedSettlers","timeOfArrival","lte","Math","floor","Date","now","findReturnedSettlers","timeOfComeback"],"mappings":"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","sourcesContent":["import Troops from \"../../models/troops-models/troops\";\nimport AttackerTroopsToBattle\n  from \"../../models/battle/attacker-troops-to-battle\";\nimport Battle from \"../../models/battle/battle\";\nimport sequelize from \"../../config/database\";\nimport {Op} from 'sequelize';\n\nconst createTroop = async (troop) => {\n  const newTroop = await Troops.create(troop);\n  return newTroop;\n}\n\nconst findRecruitedTroopTypeByKingdomId = async (kingdomId, type) => {\n  const troopType = await Troops.findOne({\n    where: {\n      kingdomId: kingdomId,\n      type: type\n    }\n  })\n  return troopType;\n}\n\nconst findRecruitedKingdomTroops = async (kingdomId) => {\n  return Troops.findAll({\n    where: {kingdomId},\n    attributes: {exclude: ['kingdomId', 'unitLevelId', 'destroyTime']}\n  });\n}\n\nconst findAllKingdomTroops = async (kingdomId) => {\n  return Troops.findAll({\n    where: {\n      kingdomId: kingdomId\n    }\n  })\n}\n\nconst findRandomKingdomTroop = async (kingdomId) => {\n  return Troops.findOne({\n    where: {\n      [Op.and]: [\n        {kingdomId},\n        {quantity: {[Op.gt]: 0}}\n      ],\n    },\n    order: sequelize.random()\n  });\n}\n\nconst findRandomKingdomTroopInBattle = async (kingdomId) => {\n  return Troops.findOne({\n    where: {\n      [Op.and]: [\n        {kingdomId},\n        {quantityInBattle: {[Op.gt]: 0}}\n      ],\n    },\n    order: sequelize.random()\n  });\n}\n\nconst findTroopInBattle = async (type, kingdomId) => {\n\n  return AttackerTroopsToBattle.findOne({\n    include: [{model: Battle, as: 'attackerTroopsToBattle'}],\n    where: {\n      [Op.and]: [\n        {type},\n        sequelize.literal('attacking_kingdom_id = ' + kingdomId)\n      ],\n    }\n  });\n\n}\n\nconst findArrivedSettlers = async () => {\n  return Troops.findAll({\n    where: {\n      timeOfArrival: {\n        [Op.lte]: Math.floor(Date.now() / 1000)\n      }\n    }\n  });\n}\n\nconst findReturnedSettlers = async () => {\n  return Troops.findAll({\n    where: {\n      timeOfComeback: {\n        [Op.lte]: Math.floor(Date.now() / 1000)\n      }\n    }\n  });\n}\n\nexport default {\n  createTroop,\n  findRecruitedKingdomTroops,\n  findRecruitedTroopTypeByKingdomId,\n  findRandomKingdomTroop,\n  findRandomKingdomTroopInBattle,\n  findTroopInBattle,\n  findArrivedSettlers,\n  findReturnedSettlers,\n  findAllKingdomTroops\n}\n"],"file":"troops-repository.js"}